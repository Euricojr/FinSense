<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinSense - An√°lise de Mercado</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-locale-pt-br-latest.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Light Mode (Default) */
            --bg-main: #f0f2f5;
            --bg-panel: #f8f9fa;
            --text-main: #1a1a1a;
            --text-muted: #666666;
            --accent-primary: #0056b3;
            --accent-hover: #004494;
            --border-color: #e0e0e0;
            --success-green: #008000;
            --danger-red: #d32f2f;
            --hero-bg: #0a192f;
            --chart-bg: #ffffff;
            --chart-grid: #e0e0e0;
        }

        [data-theme="dark"] {
            /* Dark Mode */
            --bg-main: #0a192f;
            --bg-panel: #112240;
            --text-main: #e6f1ff;
            --text-muted: #8892b0;
            --accent-primary: #4da3ff;
            --accent-hover: #2d89ef;
            --border-color: #233554;
            --success-green: #64ffda;
            --danger-red: #ff5f56;
            --hero-bg: #020c1b;
            --chart-bg: #112240;
            --chart-grid: #233554;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            background-color: var(--bg-main);
            color: var(--text-main);
            font-family: 'Manrope', sans-serif;
            font-size: 14px;
            overflow-x: hidden;
            transition: background-color 0.3s, color 0.3s;
        }

        /* --- Scrollbar --- */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-panel);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--accent-primary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-hover);
        }

        /* --- Header --- */
        header {
            background-color: transparent;
            padding: 0 40px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: absolute;
            top: 0;
            width: 100%;
            z-index: 1000;
        }

        .logo {
            font-weight: 700;
            font-size: 22px;
            color: white;
        }

        nav a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            margin-left: 30px;
            font-weight: 500;
            transition: color 0.2s;
        }

        nav a:hover {
            color: white;
        }

        .theme-toggle {
            background: none;
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            cursor: pointer;
            font-size: 18px;
            margin-left: 25px;
            padding: 5px 10px;
            border-radius: 20px;
            transition: all 0.3s;
        }

        .theme-toggle:hover {
            background-color: rgba(255, 255, 255, 0.1);
            border-color: white;
        }

        /* --- Hero Section --- */
        .hero {
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            background: linear-gradient(135deg, #0a192f 0%, #112240 100%);
            color: white;
            padding: 0 20px;
            position: relative;
            overflow: hidden;
            /* Ensure particles don't overflow */
        }

        #hero-particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            /* Behind content but above background */
            pointer-events: none;
            /* Allow clicks to pass through */
        }

        .hero h1,
        .hero p,
        .hero .cta-button {
            position: relative;
            z-index: 2;
            /* Ensure content is above particles */
        }

        .hero h1 {
            font-size: 56px;
            font-weight: 800;
            margin-bottom: 20px;
            max-width: 900px;
            line-height: 1.1;
        }

        .hero p {
            font-size: 20px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 50px;
            max-width: 700px;
        }

        .cta-button {
            background-color: var(--accent-primary);
            color: white;
            padding: 18px 50px;
            border-radius: 40px;
            text-decoration: none;
            font-weight: 600;
            font-size: 18px;
            transition: all 0.3s;
            box-shadow: 0 4px 20px rgba(0, 86, 179, 0.4);
        }

        .cta-button:hover {
            background-color: var(--accent-hover);
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(0, 86, 179, 0.6);
        }

        .scroll-indicator {
            position: absolute;
            bottom: 30px;
            font-size: 24px;
            animation: bounce 2s infinite;
            color: rgba(255, 255, 255, 0.5);
            z-index: 2;
        }

        @keyframes bounce {

            0%,
            20%,
            50%,
            80%,
            100% {
                transform: translateY(0);
            }

            40% {
                transform: translateY(-10px);
            }

            60% {
                transform: translateY(-5px);
            }
        }

        /* --- Dashboard Section --- */
        #dashboard {
            height: 100vh;
            /* Full viewport height */
            display: flex;
            flex-direction: column;
            background-color: var(--bg-main);
            overflow: hidden;
            /* Prevent body scroll within dashboard */
        }

        .dashboard-header {
            padding: 10px 20px;
            background-color: var(--hero-bg);
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            height: 50px;
            /* Fixed height */
            transition: background-color 0.3s;
        }

        .dashboard-title {
            font-size: 18px;
            font-weight: 700;
        }

        .main-container {
            display: flex;
            flex: 1;
            padding: 10px;
            gap: 10px;
            background-color: var(--bg-main);
            height: calc(100vh - 50px);
            /* Fill remaining height */
            width: 100%;
            max-width: 100%;
            /* Full width */
            margin: 0;
            box-sizing: border-box;
        }

        /* --- Chart Section (Left) --- */
        .chart-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: var(--bg-panel);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border-color);
            height: 100%;
            /* Fill container */
            overflow: hidden;
        }

        /* --- Chart Section (Left) --- */
        .chart-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: var(--bg-panel);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border-color);
            height: 100%;
            /* Fill container */
            overflow: hidden;
        }

        /* --- Market Section --- */
        #mercado {
            min-height: 100vh;
            height: auto;
            display: flex;
            flex-direction: column;
            background-color: var(--bg-main);
            padding-top: 70px;
            /* Header space */
            padding-bottom: 40px;
        }

        .market-container {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .heatmap-container {
            background-color: var(--bg-panel);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* --- Market Grid Styles --- */
        .market-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            padding: 5px;
        }

        .market-card {
            background-color: var(--bg-main);
            border-radius: 8px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 75px;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: default;
            color: #ffffff !important;
            /* Force white text */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .market-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        /* Brighter, more readable colors */
        .market-card.positive {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border: 1px solid #059669;
        }

        .market-card.negative {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border: 1px solid #dc2626;
        }

        .card-symbol {
            font-size: 13px;
            font-weight: 800;
            margin-bottom: 2px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        .card-price {
            font-size: 13px;
            font-weight: 600;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        .card-change {
            font-size: 12px;
            font-weight: 700;
            margin-top: auto;
            opacity: 1;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        .heatmap-loading {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
            border-radius: 12px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        [data-theme="dark"] .heatmap-loading {
            background-color: rgba(17, 34, 64, 0.8);
        }

        .heatmap-loading.active {
            opacity: 1;
            pointer-events: all;
        }

        .heatmap-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-main);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .chart-title-group {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .chart-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-main);
        }

        .price-display {
            font-size: 24px;
            font-weight: 400;
            color: var(--accent-primary);
        }

        .controls {
            display: flex;
            gap: 15px;
            align-items: flex-end;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
            align-items: center;
        }

        .control-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            text-align: center;
        }

        select,
        input[type="number"] {
            background-color: var(--bg-panel);
            color: var(--text-main);
            border: 1px solid var(--border-color);
            padding: 4px 8px;
            border-radius: 6px;
            font-family: inherit;
            font-size: 13px;
            outline: none;
            cursor: pointer;
            height: 32px;
            text-align: center;
        }

        select:hover,
        input:hover {
            border-color: #bbb;
        }

        /* --- Sidebar (Right) --- */
        .sidebar {
            flex: none;
            width: 320px;
            display: flex;
            flex-direction: column;
            background-color: var(--bg-panel);
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border-color);
            overflow: hidden;
            height: 100%;
            /* Fill container */
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            background-color: var(--bg-panel);
        }

        /* Styled Selector */
        .custom-select {
            width: 100%;
            padding: 10px 15px;
            background-color: var(--bg-main);
            color: var(--text-main);
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
            height: auto;
            /* Override global select height */
        }

        .custom-select:hover {
            border-color: var(--accent-primary);
            background-color: var(--bg-panel);
        }

        .custom-select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(0, 86, 179, 0.1);
        }

        .asset-list {
            flex: 1;
            overflow-y: auto;
            max-height: 800px;
        }

        .asset-item {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.2s;
        }

        .asset-item:hover {
            background-color: var(--bg-main);
        }

        .asset-item.active {
            background-color: rgba(0, 86, 179, 0.1);
            border-left: 4px solid var(--accent-primary);
        }

        .asset-info {
            display: flex;
            flex-direction: column;
        }

        .asset-symbol {
            font-weight: 600;
            font-size: 14px;
            color: var(--text-main);
        }

        .asset-name {
            font-size: 12px;
            color: var(--text-muted);
        }

        .asset-price-info {
            text-align: right;
        }

        .asset-price {
            font-weight: 500;
            font-size: 14px;
            color: var(--text-main);
        }

        .asset-change {
            font-size: 12px;
            font-weight: 600;
        }

        .positive {
            color: var(--success-green);
        }

        .negative {
            color: var(--danger-red);
        }

        /* --- Spinner --- */
        .spinner {
            border: 3px solid rgba(0, 86, 179, 0.1);
            border-left-color: var(--accent-primary);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-left: 10px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .spinner.active {
            opacity: 1;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Checkbox Style */
        input[type="checkbox"] {
            appearance: none;
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border: 1px solid var(--text-muted);
            border-radius: 4px;
            background-color: var(--bg-panel);
            cursor: pointer;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        input[type="checkbox"]:checked {
            background-color: var(--accent-primary);
            border-color: var(--accent-primary);
        }

        input[type="checkbox"]:checked::after {
            content: '‚úî';
            font-size: 12px;
            color: white;
        }

        /* --- Multiselect Dropdown --- */
        .multiselect-container {
            position: relative;
            display: inline-block;
            width: 200px;
        }

        .multiselect-btn {
            background-color: var(--bg-panel);
            color: var(--text-main);
            border: 1px solid var(--border-color);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            width: 100%;
            text-align: left;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .multiselect-btn::after {
            content: '‚ñº';
            font-size: 10px;
            margin-left: 10px;
        }

        .multiselect-menu {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: var(--bg-panel);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            margin-top: 5px;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            padding: 5px 0;
        }

        .multiselect-menu.active {
            display: block;
        }

        .multiselect-item {
            padding: 8px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .multiselect-item:hover {
            background-color: var(--bg-main);
        }

        .multiselect-item label {
            cursor: pointer;
            font-size: 13px;
            color: var(--text-main);
            flex: 1;
            white-space: nowrap;
        }

        /* --- Market Movers Section --- */
        .market-movers {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .mover-card {
            background-color: var(--bg-panel);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border-color);
        }

        .mover-card h3 {
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 16px;
            color: var(--text-muted);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }

        .mover-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .mover-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .mover-item:last-child {
            border-bottom: none;
        }

        .mover-symbol {
            font-weight: 600;
            color: var(--text-main);
        }

        .mover-price {
            color: var(--text-muted);
            font-size: 13px;
            margin-right: 15px;
        }

        .mover-change {
            font-weight: 600;
            font-size: 13px;
        }

        .change-positive {
            color: #00c853;
        }

        .change-negative {
            color: #d32f2f;
        }



        /* New Styles for Destaques Section */
        #destaques {
            padding: 40px;
            /* Increased padding overall, effectively more separation */
            margin-top: 30px;
            /* Added explicit margin for "descer mais um pouco" */
        }

        .mover-card {
            background-color: var(--bg-panel);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border-color);
        }

        .destaques-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .destaques-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .mover-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }


        .mover-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .mover-item:last-child {
            border-bottom: none;
        }

        .mover-symbol {
            font-weight: 600;
            color: var(--text-main);
        }

        .mover-price {
            color: var(--text-muted);
            font-size: 13px;
            margin-right: 15px;
        }

        .mover-change {
            font-weight: 600;
            font-size: 13px;
        }

        .change-positive {
            color: #00c853;
        }

        .change-negative {
            color: #d32f2f;
        }
    </style>
</head>

<body>

    <header>
        <div class="logo">FinSense</div>
        <nav>
            <a href="#">In√≠cio</a>
            <a href="#dashboard">Plataforma</a>
            <a href="#mercado">Mercado</a>
            <a href="analise_carteiras.html">An√°lise de Carteiras</a>
            <button id="theme-btn" class="theme-toggle" onclick="toggleTheme()" title="Alternar Tema">üåô</button>
        </nav>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <canvas id="hero-particles"></canvas>
        <h1>Intelig√™ncia Financeira<br>ao seu Alcance</h1>
        <p>Monitore o mercado global em tempo real com a precis√£o que voc√™ precisa para tomar as melhores decis√µes.</p>
        <a href="#dashboard" class="cta-button">Acessar Plataforma</a>
        <a href="#dashboard" class="scroll-indicator" style="text-decoration: none; color: rgba(255,255,255,0.5);">‚Üì</a>
    </section>

    <!-- Dashboard Section -->
    <section id="dashboard">
        <div class="dashboard-header">
            <div class="dashboard-title">FinSense Dashboard</div>
        </div>

        <div class="main-container">

            <!-- Chart Section (Left) -->
            <div class="chart-section">
                <div class="chart-header">
                    <div class="chart-title-group">
                        <span id="titulo-ativo" class="chart-title">BTC-USD</span>
                        <span id="preco" class="price-display">---</span>
                        <div id="chart-spinner" class="spinner"></div>
                    </div>

                    <div class="controls">
                        <div class="control-group">
                            <label class="control-label">Quantidade de Velas</label>
                            <select id="seletor-periodo" onchange="mudouAtivo()">
                                <option value="1d">1 Dia</option>
                                <option value="5d">5 Dias</option>
                                <option value="1mo">1 M√™s</option>
                                <option value="3mo">3 Meses</option>
                                <option value="6mo">6 Meses</option>
                                <option value="1y" selected>1 Ano</option>
                                <option value="max">M√°x</option>
                            </select>
                        </div>

                        <div class="control-group">
                            <label class="control-label">Tempo</label>
                            <select id="seletor-intervalo" onchange="mudouAtivo()">
                                <option value="15m">15 Min</option>
                                <option value="30m">30 Min</option>
                                <option value="1h">1 Hora</option>
                                <option value="1d" selected>1 Dia</option>
                                <option value="1wk">1 Sem</option>
                            </select>
                        </div>



                        <div class="control-group">
                            <label class="control-label">Indicadores</label>
                            <div class="multiselect-container">
                                <button class="multiselect-btn" onclick="toggleMultiselect()">Selecionar...</button>
                                <div id="multiselect-menu" class="multiselect-menu">
                                    <div class="multiselect-item" onclick="toggleCheck('check-ma')">
                                        <input type="checkbox" id="check-ma" checked onchange="mudouAtivo()">
                                        <label>M√©dia M√≥vel</label>
                                        <input type="number" id="input-ma" value="14" min="1" max="200"
                                            onchange="mudouAtivo()" onclick="event.stopPropagation()"
                                            style="width: 50px; padding: 2px 5px; font-size: 12px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-main); color: var(--text-main);">
                                    </div>
                                    <div class="multiselect-item" onclick="toggleCheck('check-rsi')">
                                        <input type="checkbox" id="check-rsi" onchange="mudouAtivo()">
                                        <label>RSI</label>
                                    </div>
                                    <div class="multiselect-item" onclick="toggleCheck('check-macd')">
                                        <input type="checkbox" id="check-macd" onchange="mudouAtivo()">
                                        <label>MACD</label>
                                    </div>
                                    <div class="multiselect-item" onclick="toggleCheck('check-stoch')">
                                        <input type="checkbox" id="check-stoch" onchange="mudouAtivo()">
                                        <label>Estoc√°stico</label>
                                    </div>
                                    <div class="multiselect-item" onclick="toggleCheck('check-vol')">
                                        <input type="checkbox" id="check-vol" onchange="mudouAtivo()">
                                        <label>Volume</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="grafico" style="width: 100%; flex: 1; min-height: 0;"></div>
            </div>

            <!-- Sidebar (Right) -->
            <div class="sidebar">
                <div class="sidebar-header">
                    <select id="list-category" onchange="carregarListaLateral()" class="custom-select">
                        <option value="cripto" selected>Criptomoedas</option>
                        <option value="br">A√ß√µes Brasil</option>
                        <option value="us">A√ß√µes EUA</option>
                        <option value="indices">√çndices Globais</option>
                    </select>
                </div>
                <div id="asset-list" class="asset-list">
                    <div style="padding: 20px; text-align: center; color: #666;">Carregando...</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Destaques do Mercado Section -->
    <section id="destaques">
        <div class="destaques-header">
            <span class="section-title">Destaques do Mercado</span>
            <select id="mover-category-select" onchange="loadMarketMovers()" class="custom-select"
                style="width: 200px;">
                <option value="all">Todas as Categorias</option>
                <option value="cripto" selected>Criptomoedas</option>
                <option value="br">A√ß√µes Brasil</option>
                <option value="us">A√ß√µes EUA</option>
                <option value="indices">√çndices Globais</option>
            </select>
        </div>
        <div class="destaques-grid">
            <div class="mover-card">
                <h3
                    style="margin-top: 0; margin-bottom: 15px; font-size: 16px; color: var(--text-muted); border-bottom: 1px solid var(--border-color); padding-bottom: 10px;">
                    Maiores Altas (Top 5)</h3>
                <ul id="gainers-list" class="mover-list">
                    <li class="mover-item"><span class="mover-symbol">Carregando...</span></li>
                </ul>
            </div>
            <div class="mover-card">
                <h3
                    style="margin-top: 0; margin-bottom: 15px; font-size: 16px; color: var(--text-muted); border-bottom: 1px solid var(--border-color); padding-bottom: 10px;">
                    Maiores Baixas (Top 5)</h3>
                <ul id="losers-list" class="mover-list">
                    <li class="mover-item"><span class="mover-symbol">Carregando...</span></li>
                </ul>
            </div>
        </div>
    </section>

    <!-- Market Section (Heatmap) -->
    <section id="mercado">
        <div class="market-container">
            <div class="heatmap-container">
                <div id="heatmap-loader" class="heatmap-loading">
                    <div class="spinner active"></div>
                    <span style="margin-left: 10px; font-weight: 600; color: var(--text-main);">Carregando
                        Mercado...</span>
                </div>
                <div class="heatmap-header">
                    <span class="section-title">Mapa de Mercado</span>
                    <select id="heatmap-category" onchange="carregarHeatmap()" class="custom-select"
                        style="width: 200px;">
                        <option value="cripto" selected>Criptomoedas</option>
                        <option value="br">A√ß√µes Brasil</option>
                        <option value="us">A√ß√µes EUA</option>
                        <option value="indices">√çndices Globais</option>
                    </select>
                </div>

                <!-- Plotly Treemap Container -->
                <div id="heatmap-plot" style="width: 100%; height: 600px;"></div>
            </div>
        </div>
    </section>

    <!-- Hidden Input for State -->
    <input type="hidden" id="ativo-atual" value="BTC-USD">

    <script src="particles.js"></script>

    <script>
        // --- Configura√ß√£o Plotly (Dynamic Theme) ---
        const plotConfig = { responsive: true, displayModeBar: false, locale: 'pt-BR' };

        function getPlotLayout() {
            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
            const bgColor = isDark ? '#112240' : '#ffffff';
            const gridColor = isDark ? '#233554' : '#e0e0e0';
            const textColor = isDark ? '#e6f1ff' : '#1a1a1a';

            return {
                paper_bgcolor: bgColor,
                plot_bgcolor: bgColor,
                font: { color: textColor, family: 'Manrope, sans-serif' },
                margin: { t: 30, l: 60, r: 40, b: 60 },
                xaxis: {
                    gridcolor: gridColor,
                    // tickangle: -30, // Let Plotly handle angle
                    automargin: true
                },
                yaxis: {
                    gridcolor: gridColor,
                    autorange: true,
                    fixedrange: false
                }
            };
        }


        // --- Theme Logic ---
        function toggleTheme() {
            const html = document.documentElement;
            const current = html.getAttribute('data-theme');
            const next = current === 'dark' ? 'light' : 'dark';

            html.setAttribute('data-theme', next);
            localStorage.setItem('theme', next);

            // Update button icon
            const btn = document.getElementById('theme-btn');
            btn.innerText = next === 'dark' ? '‚òÄÔ∏è' : 'üåô';

            // Refresh chart to apply new theme
            mudouAtivo();
            carregarHeatmap();
        }

        function loadTheme() {
            const saved = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', saved);
            const btn = document.getElementById('theme-btn');
            if (btn) btn.innerText = saved === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        }

        function toggleSpinner(id, show) {
            const el = document.getElementById(id);
            if (el) {
                if (show) el.classList.add('active');
                else el.classList.remove('active');
            }
        }

        // --- Multiselect Logic ---
        function toggleMultiselect() {
            const menu = document.getElementById('multiselect-menu');
            menu.classList.toggle('active');
        }

        // Helper to toggle checkbox when clicking the row
        function toggleCheck(id) {
            // Prevent double toggle if clicking the checkbox itself
            if (event.target.type === 'checkbox') return;

            const check = document.getElementById(id);
            check.checked = !check.checked;
            mudouAtivo();
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function (event) {
            const container = document.querySelector('.multiselect-container');
            const menu = document.getElementById('multiselect-menu');
            if (container && !container.contains(event.target)) {
                menu.classList.remove('active');
            }
        });

        // --- Sidebar Logic ---
        async function carregarListaLateral() {
            const listaDiv = document.getElementById('asset-list');
            listaDiv.innerHTML = '<div style="padding: 20px; text-align: center; color: #666;">Atualizando...</div>';

            try {
                const categoria = document.getElementById('list-category').value;
                const response = await fetch(`http://127.0.0.1:5000/api/heatmap?type=${categoria}`);
                const dados = await response.json();

                listaDiv.innerHTML = '';

                dados.forEach(ativo => {
                    const item = document.createElement('div');
                    item.className = 'asset-item';
                    item.onclick = () => selecionarAtivo(ativo.symbol, item);

                    const changeClass = ativo.change >= 0 ? 'positive' : 'negative';
                    const changeSign = ativo.change >= 0 ? '+' : '';

                    let currency = "$";
                    if (ativo.symbol.endsWith('.SA') || ativo.symbol === 'BRL=X' || ativo.symbol === '^BVSP') {
                        currency = "R$";
                    }

                    // Friendly Name Logic
                    const displayName = ativo.name || ativo.symbol;

                    item.innerHTML = `
                        <div class="asset-info">
                            <span class="asset-symbol" style="font-size: 14px;">${displayName}</span>
                            ${ativo.name ? `<span style="font-size: 11px; color: var(--text-muted);">${ativo.symbol}</span>` : ''}
                        </div>
                        <div class="asset-price-info">
                            <div class="asset-price">${currency} ${ativo.price.toFixed(2)}</div>
                            <div class="asset-change ${changeClass}">${changeSign}${ativo.change.toFixed(2)}%</div>
                        </div>
                    `;
                    listaDiv.appendChild(item);
                });

            } catch (e) {
                console.error("Erro lista:", e);
                listaDiv.innerHTML = '<div style="padding: 20px; text-align: center; color: red;">Erro ao carregar lista.<br>Recarregue a p√°gina</div>';
            }
        }

        function selecionarAtivo(ticker, elementoDOM) {
            document.getElementById('ativo-atual').value = ticker;

            document.querySelectorAll('.asset-item').forEach(el => el.classList.remove('active'));
            if (elementoDOM) elementoDOM.classList.add('active');

            mudouAtivo();
        }

        // --- Heatmap (Plotly Treemap) Logic ---
        async function carregarHeatmap() {
            const loader = document.getElementById('heatmap-loader');

            // Show loader
            if (loader) loader.classList.add('active');

            try {
                const categoria = document.getElementById('heatmap-category').value;
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 10000); // 10s timeout

                const response = await fetch(`http://127.0.0.1:5000/api/heatmap?type=${categoria}`, { signal: controller.signal });
                clearTimeout(timeoutId);

                const dados = await response.json();

                if (!dados || dados.length === 0) {
                    document.getElementById('heatmap-plot').innerHTML = '<div style="text-align: center; padding: 50px; color: var(--text-muted);">Sem dados dispon√≠veis</div>';
                    return;
                }

                // Prepare data for Treemap
                const labels = [];
                const parents = [];
                const values = []; // Size (abs change)
                const texts = [];  // Display text
                const colors = []; // Colors based on change

                const categoryNames = {
                    'cripto': 'Criptomoedas',
                    'br': 'A√ß√µes Brasil',
                    'us': 'A√ß√µes EUA',
                    'indices': '√çndices Globais'
                };
                const rootLabel = categoryNames[categoria] || "Mercado";

                dados.forEach(ativo => {
                    labels.push(ativo.symbol);
                    parents.push(rootLabel); // Group all under the category

                    // Size: Absolute value of change (min size 0.1 to show even small changes)
                    values.push(Math.abs(ativo.change) + 0.01);

                    const isPositive = ativo.change >= 0;
                    const changeSign = isPositive ? '+' : '';

                    let currency = "$";
                    if (ativo.symbol.endsWith('.SA') || ativo.symbol === 'BRL=X' || ativo.symbol === '^BVSP') {
                        currency = "R$";
                    }

                    // Custom text for the block
                    // Use Name from backend if available
                    const displayName = ativo.name || ativo.symbol;

                    texts.push(`<b>${displayName}</b><br><span style="font-size:0.8em">${ativo.symbol}</span><br>${currency} ${ativo.price.toFixed(2)}<br>${changeSign}${ativo.change.toFixed(2)}%`);

                    // Color logic
                    if (isPositive) {
                        // Green scale
                        colors.push('#10b981');
                    } else {
                        // Red scale
                        colors.push('#ef4444');
                    }
                });

                const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
                const textColor = '#ffffff'; // Always white text inside blocks
                const textColors = [];

                // Populate colors for assets
                dados.forEach(() => {
                    textColors.push(textColor);
                });

                // Add Root Node
                labels.push(rootLabel);
                parents.push("");
                values.push(0);
                texts.push("");
                colors.push("transparent");

                // Color for root node label
                // If dark mode, match background (#112240) to hide it. Else white.
                if (isDark) {
                    textColors.push('#112240');
                } else {
                    textColors.push(textColor);
                }


                const data = [{
                    type: "treemap",
                    labels: labels,
                    parents: parents,
                    values: values,
                    text: texts,
                    textinfo: "text",
                    hoverinfo: "label+text+value",
                    pathbar: { visible: false }, // Hide the top bar "Mercado"
                    marker: {
                        colors: colors,
                        line: { width: 1, color: isDark ? '#112240' : '#ffffff' }
                    },
                    textfont: {
                        family: 'Manrope, sans-serif',
                        size: 14,
                        color: textColors,
                        weight: 700
                    },
                    tiling: {
                        packing: 'squarify' // 'squarify', 'binary', 'dice', 'slice', 'slice-dice', 'dice-slice'
                    }
                }];

                const layout = {
                    margin: { t: 0, l: 0, r: 0, b: 0 },
                    paper_bgcolor: 'transparent',
                    font: { family: 'Manrope, sans-serif' }
                };

                Plotly.newPlot('heatmap-plot', data, layout, { responsive: true, displayModeBar: false });



            } catch (e) {
                console.error("Erro heatmap:", e);
                document.getElementById('heatmap-plot').innerHTML = '<div style="text-align: center; padding: 50px; color: red;">Erro ao carregar mercado<br>Recarregue a p√°gina</div>';
            } finally {
                // Hide loader
                if (loader) loader.classList.remove('active');
            }
        }

        // --- Chart Logic ---
        async function mudouAtivo() {
            toggleSpinner('chart-spinner', true);

            const ativoSelecionado = document.getElementById('ativo-atual').value;
            const periodo = document.getElementById('seletor-periodo').value;
            const intervalo = document.getElementById('seletor-intervalo').value;
            const maPeriod = document.getElementById('input-ma').value;
            const showRSI = document.getElementById('check-rsi').checked;
            const showMACD = document.getElementById('check-macd').checked;
            const showStoch = document.getElementById('check-stoch').checked;
            const showVol = document.getElementById('check-vol').checked;
            const checkMaEl = document.getElementById('check-ma');
            const showMA = checkMaEl ? checkMaEl.checked : true; // Default to true if not found

            try {
                const response = await fetch(`http://127.0.0.1:5000/api/dados?ticker=${ativoSelecionado}&period=${periodo}&interval=${intervalo}&ma_period=${maPeriod}`);
                if (!response.ok) throw new Error("Erro na API");
                const dados = await response.json();

                document.getElementById('titulo-ativo').innerText = dados.symbol;

                let currencySymbol = "$";
                if (dados.symbol.endsWith('.SA') || dados.symbol === 'BRL=X' || dados.symbol === '^BVSP') {
                    currencySymbol = "R$";
                }
                const precoEl = document.getElementById('preco');
                precoEl.innerText = `${currencySymbol} ${dados.preco_atual}`;

                const traces = [];

                // Main Candle Trace
                traces.push({
                    x: dados.datas,
                    close: dados.close,
                    decreasing: { line: { color: '#d32f2f', width: 1 } },
                    high: dados.high,
                    increasing: { line: { color: '#008000', width: 1 } },
                    low: dados.low,
                    open: dados.open,
                    type: 'candlestick',
                    name: 'Pre√ßo'
                });

                // Moving Average Trace
                if (showMA) {
                    traces.push({
                        x: dados.datas,
                        y: dados.ma,
                        type: 'scatter',
                        mode: 'lines',
                        line: { color: getComputedStyle(document.documentElement).getPropertyValue('--accent-primary').trim(), width: 1.5 },
                        name: dados.ma_label
                    });
                }

                const layout = {
                    ...getPlotLayout(),
                    dragmode: 'pan',
                    showlegend: false,
                    xaxis: {
                        ...getPlotLayout().xaxis,
                        type: 'date',
                        rangeslider: { visible: false }
                    }
                };

                // --- Smart Tick Generation Logic ---
                // Identify target number of ticks
                const targetTicks = 8;
                const len = dados.datas.length;
                const step = Math.max(1, Math.floor(len / targetTicks));

                const tickVals = [];
                const tickText = [];

                for (let i = 0; i < len; i += step) {
                    tickVals.push(dados.datas[i]); // In category axis, the value is the category name itself (the date string)

                    // Format Label
                    const dateObj = new Date(dados.datas[i]);
                    let label = "";

                    if (periodo.includes('d') || periodo.includes('wk') || periodo.includes('mo')) {
                        // Daily/Weekly: "DD MMM" (e.g., "14 Nov")
                        const day = dateObj.getDate();
                        const month = dateObj.toLocaleDateString('pt-BR', { month: 'short' });
                        // Remove dot from month if present
                        label = `${day} ${month.replace('.', '')}`;
                    } else if (periodo.includes('1d') || intervalo.includes('m') || intervalo.includes('h')) {
                        // Intraday: "HH:mm" (e.g., "14:30") 
                        // For longer intraday periods, might need date too
                        if (periodo === '1d' || periodo === '5d') {
                            const hours = String(dateObj.getHours()).padStart(2, '0');
                            const mins = String(dateObj.getMinutes()).padStart(2, '0');
                            const day = dateObj.getDate();
                            if (periodo === '5d') {
                                label = `${day} - ${hours}:${mins}`;
                            } else {
                                label = `${hours}:${mins}`;
                            }
                        } else {
                            // Default fallback
                            const day = dateObj.getDate();
                            const month = dateObj.toLocaleDateString('pt-BR', { month: 'short' });
                            label = `${day} ${month.replace('.', '')}`;
                        }
                    } else {
                        // Default
                        const day = dateObj.getDate();
                        const month = dateObj.toLocaleDateString('pt-BR', { month: 'short' });
                        label = `${day} ${month.replace('.', '')}`;
                    }
                    tickText.push(label);
                }

                // Standardize ALL charts (Crypto + Stocks) to use Category axis with CUSTOM TICKS.
                layout.xaxis.type = 'category';
                layout.xaxis.tickmode = 'array'; // Manual ticks
                layout.xaxis.tickvals = tickVals;
                layout.xaxis.ticktext = tickText;
                // layout.xaxis.nticks is ignored when tickmode is array






                // Dynamic Layout Logic for Indicators
                const indicators = [];
                if (showRSI) indicators.push('rsi');
                if (showMACD) indicators.push('macd');
                if (showStoch) indicators.push('stoch');
                if (showVol) indicators.push('vol');

                const numIndicators = indicators.length;
                let mainDomain = [0.1, 1];

                if (numIndicators === 0) {
                    mainDomain = [0, 1];
                } else if (numIndicators === 1) {
                    mainDomain = [0.3, 1];
                } else if (numIndicators === 2) {
                    mainDomain = [0.45, 1];
                } else if (numIndicators === 3) {
                    mainDomain = [0.55, 1];
                } else if (numIndicators === 4) {
                    mainDomain = [0.60, 1];
                }

                layout.yaxis.domain = mainDomain;

                // Helper to get domain for a specific slot index (0 = bottom)
                function getDomain(idx, total) {
                    if (total === 1) return [0, 0.2];
                    if (total === 2) {
                        if (idx === 0) return [0, 0.2];
                        if (idx === 1) return [0.25, 0.40];
                    }
                    if (total === 3) {
                        if (idx === 0) return [0, 0.15];
                        if (idx === 1) return [0.20, 0.35];
                        if (idx === 2) return [0.40, 0.50];
                    }
                    if (total === 4) {
                        if (idx === 0) return [0, 0.10];
                        if (idx === 1) return [0.15, 0.25];
                        if (idx === 2) return [0.30, 0.40];
                        if (idx === 3) return [0.45, 0.55];
                    }
                    return [0, 0.2];
                }

                // Assign slots based on fixed order: Vol -> Stoch -> MACD -> RSI (Bottom to Top)
                // Actually let's do: RSI (Top) -> MACD -> Stoch -> Vol (Bottom)
                // Filter active indicators in that priority
                const activeTypes = [];
                if (showRSI) activeTypes.push('rsi');
                if (showMACD) activeTypes.push('macd');
                if (showStoch) activeTypes.push('stoch');
                if (showVol) activeTypes.push('vol');
                // In this list, index 0 is top-most subplot, index last is bottom-most.
                // We need to map them to getDomain indices where 0 is bottom.
                // So 'vol' (if present) should roughly take index 0 of getDomain? 

                // Let's reverse so index 0 is bottom-most?
                // activeTypes reversed: Vol, Stoch, MACD, RSI
                const reversedTypes = [...activeTypes].reverse();



                // --- RSI Logic ---
                if (showRSI && dados.rsi) {
                    const slotIndex = reversedTypes.indexOf('rsi');
                    const rsiDomain = getDomain(slotIndex, numIndicators);

                    layout.yaxis2 = {
                        domain: rsiDomain,
                        range: [0, 100],
                        gridcolor: layout.yaxis.gridcolor,
                        fixedrange: true,
                        tickfont: layout.yaxis.tickfont
                    };

                    // RSI Trace
                    traces.push({
                        x: dados.datas,
                        y: dados.rsi,
                        type: 'scatter',
                        mode: 'lines',
                        line: { color: '#9c27b0', width: 1.5 },
                        name: 'RSI',
                        yaxis: 'y2'
                    });

                    // Overbought/Oversold Lines
                    const lineStyle = { color: 'rgba(128,128,128,0.5)', width: 1, dash: 'dash' };
                    traces.push({
                        x: [dados.datas[0], dados.datas[dados.datas.length - 1]],
                        y: [70, 70],
                        type: 'scatter',
                        mode: 'lines',
                        line: lineStyle,
                        showlegend: false,
                        hoverinfo: 'none',
                        yaxis: 'y2'
                    });
                    traces.push({
                        x: [dados.datas[0], dados.datas[dados.datas.length - 1]],
                        y: [30, 30],
                        type: 'scatter',
                        mode: 'lines',
                        line: lineStyle,
                        showlegend: false,
                        hoverinfo: 'none',
                        yaxis: 'y2'
                    });
                }




                // --- MACD Logic ---
                if (showMACD && dados.macd_line) {
                    const slotIndex = reversedTypes.indexOf('macd');
                    const macdDomain = getDomain(slotIndex, numIndicators);

                    // MACD Axis
                    layout.yaxis3 = {
                        domain: macdDomain,
                        gridcolor: layout.yaxis.gridcolor,
                        fixedrange: true,
                        tickfont: layout.yaxis.tickfont
                    };


                    const colors = {
                        macd: '#2962FF',
                        signal: '#FF6D00',
                        histUp: '#26A69A',
                        histDown: '#EF5350'
                    };

                    // MACD Histogram
                    traces.push({
                        x: dados.datas,
                        y: dados.macd_hist,
                        type: 'bar',
                        name: 'Histograma',
                        marker: {
                            color: dados.macd_hist.map(v => v >= 0 ? colors.histUp : colors.histDown)
                        },
                        yaxis: 'y3'
                    });

                    // MACD Line
                    traces.push({
                        x: dados.datas,
                        y: dados.macd_line,
                        type: 'scatter',
                        mode: 'lines',
                        line: { color: colors.macd, width: 1.5 },
                        name: 'MACD',
                        yaxis: 'y3'
                    });

                    // Signal Line
                    traces.push({
                        x: dados.datas,
                        y: dados.signal_line,
                        type: 'scatter',
                        mode: 'lines',
                        line: { color: colors.signal, width: 1.5 },
                        name: 'Sinal',
                        yaxis: 'y3'
                    });
                }



                // --- Slow Stochastic Logic ---
                if (showStoch && dados.stoch_k) {
                    const slotIndex = reversedTypes.indexOf('stoch');
                    const stochDomain = getDomain(slotIndex, numIndicators);

                    layout.yaxis4 = {
                        domain: stochDomain,
                        range: [0, 100],
                        gridcolor: layout.yaxis.gridcolor,
                        fixedrange: true,
                        tickfont: layout.yaxis.tickfont
                    };

                    // Slow K
                    traces.push({
                        x: dados.datas,
                        y: dados.stoch_k,
                        type: 'scatter',
                        mode: 'lines',
                        line: { color: '#00E5FF', width: 1.5 },
                        name: 'Stoch %K',
                        yaxis: 'y4'
                    });

                    // Slow D
                    traces.push({
                        x: dados.datas,
                        y: dados.stoch_d,
                        type: 'scatter',
                        mode: 'lines',
                        line: { color: '#FF4081', width: 1.5 },
                        name: 'Stoch %D',
                        yaxis: 'y4'
                    });

                    // Limits 20/80
                    const lineStyle = { color: 'rgba(128,128,128,0.5)', width: 1, dash: 'dash' };
                    traces.push({
                        x: [dados.datas[0], dados.datas[dados.datas.length - 1]],
                        y: [80, 80],
                        type: 'scatter',
                        mode: 'lines',
                        line: lineStyle,
                        showlegend: false,
                        hoverinfo: 'none',
                        yaxis: 'y4'
                    });
                    traces.push({
                        x: [dados.datas[0], dados.datas[dados.datas.length - 1]],
                        y: [20, 20],
                        type: 'scatter',
                        mode: 'lines',
                        line: lineStyle,
                        showlegend: false,
                        hoverinfo: 'none',
                        yaxis: 'y4'
                    });
                }

                // --- Volume Logic ---
                if (showVol && dados.volume) {
                    const slotIndex = reversedTypes.indexOf('vol');
                    const volDomain = getDomain(slotIndex, numIndicators);

                    layout.yaxis5 = {
                        domain: volDomain,
                        gridcolor: layout.yaxis.gridcolor,
                        fixedrange: true,
                        tickfont: layout.yaxis.tickfont
                    };

                    // Calculate colors (Green if Close > Open, else Red)
                    const volColors = dados.close.map((c, i) => {
                        const open = dados.open[i];
                        return c >= open ? '#008000' : '#d32f2f';
                    });

                    traces.push({
                        x: dados.datas,
                        y: dados.volume,
                        type: 'bar',
                        name: 'Volume',
                        marker: { color: volColors },
                        yaxis: 'y5'
                    });
                }

                Plotly.react('grafico', traces, layout, plotConfig);

            } catch (erro) {
                console.error("Erro:", erro);
                document.getElementById('titulo-ativo').innerText = "Erro ao carregar";
            } finally {
                toggleSpinner('chart-spinner', false);
            }
        }

        // --- Market Movers Logic ---
        async function loadMarketMovers() {
            const listGainers = document.getElementById('gainers-list');
            const listLosers = document.getElementById('losers-list');

            try {
                const category = document.getElementById('mover-category-select').value;
                const response = await fetch(`http://127.0.0.1:5000/api/market-movers?type=${category}`);
                if (!response.ok) throw new Error("API Error");
                const data = await response.json();

                renderMoverList('gainers-list', data.gainers);
                renderMoverList('losers-list', data.losers);

            } catch (e) {
                console.error("Erro loading movers:", e);
                const retryBtn = `<button onclick="loadMarketMovers()" style="background:none; border:none; color:var(--accent-primary); cursor:pointer; text-decoration:underline;">Recarregar</button>`;
                const errorHtml = `<li class="mover-item" style="color:var(--text-muted); justify-content:center; flex-direction:column;">
                                    <span>Erro ao carregar dados.</span>
                                    ${retryBtn}
                                   </li>`;

                if (listGainers) listGainers.innerHTML = errorHtml;
                if (listLosers) listLosers.innerHTML = errorHtml;
            }
        }

        function renderMoverList(elementId, items) {
            const list = document.getElementById(elementId);
            if (!list) return;
            list.innerHTML = '';

            items.forEach(item => {
                const li = document.createElement('li');
                li.className = 'mover-item';

                const changeClass = item.change >= 0 ? 'change-positive' : 'change-negative';
                const sign = item.change >= 0 ? '+' : '';

                // Name Logic: Use name if available, else symbol
                // Prioritize Name as main display
                const displayName = item.name || item.symbol;

                li.innerHTML = `
            <div style="display:flex; flex-direction:column;">
                <span class="mover-symbol" style="font-size:14px;">${displayName}</span>
                ${item.name ? `<span style="font-size:11px; color:var(--text-muted);">${item.symbol}</span>` : ''}
            </div>
            <div>
                <span class="mover-price">$${item.price.toFixed(2)}</span>
                <span class="mover-change ${changeClass}">${sign}${item.change.toFixed(2)}%</span>
            </div>
        `;
                list.appendChild(li);
            });
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', () => {
            loadTheme();
            carregarListaLateral();
            carregarHeatmap();
            mudouAtivo();
            loadMarketMovers(); // New

            setInterval(() => mudouAtivo(), 60000);
            setInterval(() => carregarListaLateral(), 60000);
            setInterval(() => carregarHeatmap(), 60000);
            setInterval(() => loadMarketMovers(), 60000); // New
        });
    </script>
</body>

</html>